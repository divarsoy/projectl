commands:
    01_update_composer:
        command: export COMPOSER_HOME=/root && /usr/bin/composer.phar self-update

option_settings:
    - namespace: aws:elasticbeanstalk:application:environment
      option_name: COMPOSER_HOME
      value: /root

    - namespace: aws:elasticbeanstalk:container:php:phpini
      option_name: document_root
      value: /public

    - namespace: aws:elasticbeanstalk:container:php:phpini
      option_name: composer_options
      value: --no-dev --no-interaction --prefer-dist --optimize-autoloader

container_commands:
    01_01_create_sql_lite:
        command: |
            mkdir -p database
            touch database/database.sqlite
        cwd: "/var/www/html"
    01_01_composer_install:
        command: "php /opt/elasticbeanstalk/support/composer.phar install"
        cwd: "/var/www/html"
    01_01_caches:
        command: |
            php artisan config:cache
            php artisan route:cache
            php artisan view:cache
        cwd: "/var/www/html"
    03_01_migrations:
        command: "php artisan migrate --force"
        cwd: "/var/www/html"
        leader_only: true
    04_01_rerun_caches:
        command: |
            php artisan config:cache
            php artisan route:cache
            php artisan view:cache
        cwd: "/var/www/html"
    05_01_fix_permissions:
        command: "chmod -R 777 storage bootstrap/cache"
        cwd: "/var/www/html"
